syntax = "proto3";

package identity.v1;

import "google/protobuf/empty.proto";

service IdentityService {
  rpc HealthCheck (HealthCheckRequest) returns (HealthCheckResponse);

  // Use Phone Number to send SMS verification code
  rpc SendSms (SendSmsRequest) returns (SendSmsResponse);

  // Verify SMS code to get a verification token
  rpc VerifySms (VerifySmsRequest) returns (VerifySmsResponse);

  // Register with Phone (verified) and Password
  rpc Register (RegisterRequest) returns (RegisterResponse);

  // Login with Phone and Password
  rpc Login (LoginRequest) returns (LoginResponse);

  // Get current user session
  rpc GetCurrentUser (google.protobuf.Empty) returns (UserProfile);
}

message HealthCheckRequest {}

message HealthCheckResponse {
  string status = 1;
}

message SendSmsRequest {
  string phone_number = 1;
}

message SendSmsResponse {
  bool success = 1;
  // In dev/test, we might return the code here for convenience, but skipping for now.
}

message VerifySmsRequest {
  string phone_number = 1;
  string code = 2;
}

message VerifySmsResponse {
  string verification_token = 1; // Token proving phone ownership
}

message RegisterRequest {
  string phone_number = 1;
  string password = 2;
  string verification_token = 3; // Must match the one from VerifySms
}

message RegisterResponse {
  string access_token = 1;
  UserProfile user_profile = 2;
}

message LoginRequest {
  string phone_number = 1;
  string password = 2;
}

message LoginResponse {
  string access_token = 1;
  UserProfile user_profile = 2;
}

enum Role {
  ROLE_UNSPECIFIED = 0;
  ROLE_GUEST = 1;
  ROLE_CAST = 2;
}

message UserProfile {
  string id = 1;
  string phone_number = 2;
  Role role = 3;
}
