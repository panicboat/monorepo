syntax = "proto3";

package portfolio.v1;

// import "buf/validate/validate.proto";

service CastService {
  rpc GetCastProfile(GetCastProfileRequest) returns (GetCastProfileResponse);
  rpc GetCastProfileByHandle(GetCastProfileByHandleRequest) returns (GetCastProfileResponse);
  rpc CreateCastProfile(CreateCastProfileRequest) returns (CreateCastProfileResponse);
  rpc SaveCastProfile(SaveCastProfileRequest) returns (SaveCastProfileResponse);
  rpc SaveCastVisibility(SaveCastVisibilityRequest) returns (SaveCastVisibilityResponse);
  rpc SaveCastImages(SaveCastImagesRequest) returns (SaveCastImagesResponse);
  rpc SaveCastPlans(SaveCastPlansRequest) returns (SaveCastPlansResponse);
  rpc SaveCastSchedules(SaveCastSchedulesRequest) returns (SaveCastSchedulesResponse);
  rpc ListCasts(ListCastsRequest) returns (ListCastsResponse);
  rpc GetUploadUrl(GetUploadUrlRequest) returns (GetUploadUrlResponse);
  rpc CheckHandleAvailability(CheckHandleAvailabilityRequest) returns (CheckHandleAvailabilityResponse);
}

enum CastVisibility {
  CAST_VISIBILITY_UNSPECIFIED = 0;
  CAST_VISIBILITY_UNREGISTERED = 1; // Onboarding not complete
  CAST_VISIBILITY_UNPUBLISHED = 2;  // Onboarding complete, not visible
  CAST_VISIBILITY_PUBLISHED = 3;    // Visible to guests
}

message SocialLinks {
  string x = 1;
  string instagram = 2;
  string tiktok = 3;
  string cityheaven = 4;
  string litlink = 5;
  repeated string others = 6;
}

message ThreeSizes {
  int32 bust = 1;
  int32 waist = 2;
  int32 hip = 3;
  string cup = 4;
}

message CastProfile {
  string user_id = 1;
  string name = 2;
  string bio = 3;
  string image_url = 4;
  CastVisibility visibility = 5;
  // promise_rate should be calculated, maybe not stored here directly or read-only
  double promise_rate = 6;
  repeated string images = 7;
  string image_path = 8;
  string tagline = 9;
  string service_category = 10;
  string location_type = 11;
  string area = 12;
  string default_schedule_start = 13;
  string default_schedule_end = 14;
  SocialLinks social_links = 15;
  int32 age = 16;
  int32 height = 17;
  string blood_type = 18;
  ThreeSizes three_sizes = 19;
  repeated string tags = 20;
  string avatar_path = 21;       // Square avatar image (S3 key)
  string avatar_url = 22;        // Signed download URL for avatar
  string handle = 23;            // Unique user-defined ID (URL key)
}

message CastPlan {
  string id = 1;
  string name = 2;
  int32 price = 3; // JPY
  int32 duration_minutes = 4;
}

message GetCastProfileRequest {
  string user_id = 1; // [(buf.validate.field).string.uuid = true];
}

message GetCastProfileResponse {
  CastProfile profile = 1;
  repeated CastPlan plans = 2;
  repeated CastSchedule schedules = 3;
}

message CreateCastProfileRequest {
  string name = 1;
  string bio = 2;
  string image_path = 3;
  string tagline = 4;
  string service_category = 5;
  string location_type = 6;
  string area = 7;
  string default_schedule_start = 8;
  string default_schedule_end = 9;
  SocialLinks social_links = 10;
  int32 age = 11;
  int32 height = 12;
  string blood_type = 13;
  ThreeSizes three_sizes = 14;
  repeated string tags = 15;
}

message CreateCastProfileResponse {
  CastProfile profile = 1;
}

message SaveCastProfileRequest {
  string name = 1;
  string bio = 2;
  string image_path = 3;
  string tagline = 4;
  string service_category = 5;
  string location_type = 6;
  string area = 7;
  string default_schedule_start = 8;
  string default_schedule_end = 9;
  SocialLinks social_links = 10;
  CastVisibility visibility = 11;
  int32 age = 12;
  int32 height = 13;
  string blood_type = 14;
  ThreeSizes three_sizes = 15;
  repeated string tags = 16;
  string handle = 17;
}

message SaveCastProfileResponse {
  CastProfile profile = 1;
}

message SaveCastVisibilityRequest {
  CastVisibility visibility = 1;
}

message SaveCastVisibilityResponse {
  CastProfile profile = 1;
}

message SaveCastImagesRequest {
  string profile_image_path = 1; // Cover/Profile image
  repeated string gallery_images = 2; // List of image URLs or Paths
  string avatar_path = 3;             // Square avatar image (S3 key)
}

message SaveCastImagesResponse {
  CastProfile profile = 1;
}

message SaveCastPlansRequest {
  repeated CastPlan plans = 1;
}

message SaveCastPlansResponse {
  repeated CastPlan plans = 1;
}

message SaveCastSchedulesRequest {
  repeated CastSchedule schedules = 1;
}

message SaveCastSchedulesResponse {
  repeated CastSchedule schedules = 1;
}

message GetUploadUrlRequest {
  string filename = 1;
  string content_type = 2;
}

message GetUploadUrlResponse {
  string url = 1;
  string key = 2;
}

message CastSchedule {
  string date = 1; // YYYY-MM-DD
  string start_time = 2; // HH:mm
  string end_time = 3; // HH:mm
  string plan_id = 4; // Optional
}

message ListCastsRequest {
  // Add filters if needed, e.g. visibility
  CastVisibility visibility_filter = 1;
}

message ListCastsResponse {
  message CastItem {
    CastProfile profile = 1;
    repeated CastPlan plans = 2;
  }
  repeated CastItem items = 1;
}

message GetCastProfileByHandleRequest {
  string handle = 1;
}

message CheckHandleAvailabilityRequest {
  string handle = 1;
}

message CheckHandleAvailabilityResponse {
  bool available = 1;
  string message = 2;
}

