## Context

Timeline のポストに対して、ゲストがコメントを投稿し、キャストが返信するインタラクションフローを実現する。コメントシステムは Social ドメインに属し、既存の `cast_posts` テーブルと関連する。

## Goals / Non-Goals

- Goals:
  - ゲストがポストにコメントできる
  - キャストがコメントに返信できる（1階層のネスト）
  - キャストが自分のポストのコメントを削除できる（モデレーション）
  - コメント投稿者が自分のコメントを削除できる
  - `comments_count` が実データを反映する
- Non-Goals:
  - 複数階層のスレッド（Reddit 型）
  - コメントの編集機能（v1 では削除のみ）
  - コメントへのリアクション（いいね等）
  - プッシュ通知（Concierge ドメインで将来対応）

## Decisions

- **Decision**: コメントは1階層のネスト（親コメント → 返信）のみサポート
  - Alternatives: 無制限ネスト → UI の複雑化、パフォーマンス問題。1階層で十分なインタラクションが可能

- **Decision**: `post_comments` テーブルに `parent_id` でリレーション管理
  - Alternatives: `replies` テーブルを別途作成 → 不要な複雑化。`parent_id` NULL = トップレベルコメント

- **Decision**: コメント削除権限はコメント投稿者 + ポストのキャスト（オーナー）
  - Alternatives: 投稿者のみ → キャストによるモデレーションが不可能

- **Decision**: `comments_count` はリスト取得時にカウントクエリで算出（非正規化しない）
  - Alternatives: カウンタキャッシュ → 整合性管理が複雑。初期はカウントクエリで十分

## Risks / Trade-offs

- カウントクエリのパフォーマンス → 投稿数・コメント数が少ない初期フェーズでは問題なし。将来的にカウンタキャッシュを検討
- 1階層制限 → 返信の返信ができない。UX 上は十分だが、将来拡張の余地を残す

## Migration Plan

1. DB テーブル作成（新規追加のため既存への影響なし）
2. Proto + バックエンド実装
3. フロントエンド実装
4. `comments_count` の実データ反映

## Open Questions

- コメントにメディア（画像）添付は必要か？（v1 ではテキストのみを推奨）
- コメントの最大文字数は？（1000文字を提案）
