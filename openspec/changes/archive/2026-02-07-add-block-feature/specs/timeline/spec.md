## ADDED Requirements

### Requirement: User Block Feature

ユーザーは他のユーザーをブロックできなければならない (MUST)。ブロックはバックエンドに永続化され、デバイス間で同期される。ブロックされたユーザーのコンテンツは表示されなくなる。

#### Scenario: ゲストがキャストをブロックする

- **GIVEN** 私はログイン済みのゲストである
- **AND** 私はブロックしていないキャストの詳細ページを見ている
- **WHEN** 私がブロックボタンをタップする
- **THEN** ブロックがバックエンドに保存される
- **AND** そのキャストの投稿がタイムラインから非表示になる
- **AND** 確認のトーストメッセージが表示される

#### Scenario: ゲストがキャストのブロックを解除する

- **GIVEN** 私はログイン済みのゲストである
- **AND** 私はブロック中のキャストがいる
- **WHEN** 私がブロック管理画面でブロック解除ボタンをタップする
- **THEN** ブロックがバックエンドから削除される
- **AND** そのキャストの投稿が再びタイムラインに表示される

#### Scenario: キャストがゲストをブロックする

- **GIVEN** 私はログイン済みのキャストである
- **AND** 私の投稿にコメントしたゲストがいる
- **WHEN** 私がそのゲストをブロックする
- **THEN** ブロックがバックエンドに保存される
- **AND** そのゲストからのコメントが非表示になる
- **AND** そのゲストは私の投稿にいいね・コメントできなくなる

#### Scenario: ブロックしたユーザーの投稿が非表示になる

- **GIVEN** 私はログイン済みのゲストである
- **AND** 私はキャスト A をブロックしている
- **WHEN** 私がタイムラインを表示する
- **THEN** キャスト A の投稿は表示されない
- **AND** 他のキャストの投稿は通常通り表示される

#### Scenario: ブロックしたユーザーのコメントが非表示になる

- **GIVEN** 私はログイン済みのゲストである
- **AND** 私はユーザー B をブロックしている
- **WHEN** 私が投稿のコメント欄を表示する
- **THEN** ユーザー B のコメントは表示されない

### Requirement: Block API

ブロック機能は API を通じて操作できなければならない (MUST)。

#### Scenario: ブロックの追加

- **GIVEN** 認証済みのユーザー
- **WHEN** POST `/api/{user_type}/blocks` を blocked_id と blocked_type を指定して呼び出す
- **THEN** ブロックが保存され、成功フラグが返される
- **AND** 既にブロック済みの場合は変更なしで成功が返される

#### Scenario: ブロックの解除

- **GIVEN** 認証済みのユーザー
- **AND** 対象ユーザーをブロック中である
- **WHEN** DELETE `/api/{user_type}/blocks?blocked_id={id}` を呼び出す
- **THEN** ブロックが削除され、成功フラグが返される

#### Scenario: ブロックリストの取得

- **GIVEN** 認証済みのユーザー
- **WHEN** GET `/api/{user_type}/blocks?limit=50` を呼び出す
- **THEN** ブロック中のユーザーリストが返される
- **AND** ページネーションに対応している

#### Scenario: ブロック状態の一括取得

- **GIVEN** 認証済みのユーザー
- **WHEN** GET `/api/{user_type}/blocks/status?user_ids={id1,id2,...}` を呼び出す
- **THEN** 各ユーザーのブロック状態がマップ形式で返される

### Requirement: Block Management UI

ユーザーは設定画面からブロックリストを管理できなければならない (MUST)。

#### Scenario: ブロックリストを表示する

- **GIVEN** 私はログイン済みのユーザーである
- **WHEN** 私が設定画面の「ブロックリスト」を開く
- **THEN** ブロック中のユーザー一覧が表示される
- **AND** 各ユーザーの名前とアバターが表示される

#### Scenario: ブロックリストからブロック解除する

- **GIVEN** 私はブロックリストを表示している
- **AND** ブロック中のユーザーがいる
- **WHEN** 私がユーザーの「ブロック解除」ボタンをタップする
- **THEN** 確認ダイアログが表示される
- **AND** 確認後、ブロックが解除される
- **AND** そのユーザーがリストから消える

## MODIFIED Requirements

### Requirement: Guest Timeline View

ゲストは全キャストの公開タイムライン投稿を閲覧できなければならない (MUST)。投稿は作成日時の降順で表示される。ブロックしたキャストの投稿は表示されない。

#### Scenario: ゲストがタイムラインを表示する

- **GIVEN** 私はログイン済みのゲストである
- **WHEN** 私がホーム画面のタイムラインタブを表示する
- **THEN** 全キャストの公開投稿が新しい順に表示される
- **AND** 各投稿にはキャストの名前とアバターが表示される
- **AND** 非公開投稿は表示されない
- **AND** ブロックしたキャストの投稿は表示されない

#### Scenario: タイムラインの無限スクロール

- **GIVEN** 私はタイムラインを表示している
- **AND** 20件以上の投稿がある
- **WHEN** 私が画面下部までスクロールする
- **THEN** 追加の投稿が自動的に読み込まれる

#### Scenario: タイムラインのフィルタリング

- **GIVEN** 私はタイムラインを表示している
- **WHEN** 私が「Following」タブを選択する
- **THEN** フォロー中のキャストの投稿のみが表示される
- **WHEN** 私が「Favorites」タブを選択する
- **THEN** お気に入り登録したキャストの投稿のみが表示される
