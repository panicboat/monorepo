# PrivateHeaven - UI/UX Implementation Spec (V3)

## 1. 開発コンテキスト
本ドキュメントは、PrivateHeaven (MVP) における **「キャストプロフィール」から「予約確定」までのコア体験** を定義するものです。
**添付/提供されるHTMLデモファイル (`*.html`) をUIデザインと挙動の「正解（Source of Truth）」として扱ってください。**

## 2. コア・コンセプト: "The Premium Promise"
* **体験のゴール:** 事務的な予約作業を排除し、情緒的な「誓約の儀式」を提供する。
* **基本方針:** **"One Screen Policy"** (チャット画面内ではページ遷移を行わず、すべてオーバーレイ/ドロワーで完結させる)。

---

## 3. 画面別 実装仕様 & 参照デモ

### A. Cast Profile (The Living Portfolio)
* **参照ファイル:** `profile_demo.html`
* **実装要件:**
    * **Hero Section:** 上記HTMLの `hero-gradient` クラスやレイアウトを再現。
    * **Trust Indicators:** レーダーチャートのアニメーション (`grow-chart`) をFramer Motionで実装。
    * **Action Button:** 固定フッターのデザインとマイクロコピーを忠実に再現。
    * **Status Signal:** 名前の横の脈動アニメーション (`pulse-ring`) を再現。

### B. Chat & Invitation (Smart Concierge)
* **参照ファイル:** `chat_builder_demo.html`
* **実装要件 (Cast側):**
    * **UI Pattern:** **Bottom Sheet (Drawer)**
    * **挙動:** チャット画面下部からスライドインする動き (`translate-y`) を再現。
    * **デザイン:** 日時選択タブや「金色のチケットアイコン」のスタイリングを適用。

### C. The Ritual (Invitation & Pledge)
* **参照ファイル:** `ui_reference.html` (または `demo.html`)
* **実装要件 (User側):**
    * **UI Pattern:** **Full Screen Overlay**
    * **Interaction:** ボタンの **長押し (Long Press / 1.5s)** によるプログレスリング進行 (`stroke-dashoffset` 制御) をFramer Motionで再現。
    * **Effect:** 完了後の「封蝋 (Sealed)」アニメーションとHaptic Feedback発火ロジックを含める。

### D. No Show Reporting (The Judgment)
* **参照ファイル:** `noshow_demo.html`
* **実装要件 (Cast側):**
    * **Appearance:** 予約カードの下に出現する管理パネルのデザイン。
    * **Alert:** 「トラブル報告」押下時の赤色警告モーダル (`danger-modal`) のデザインと緊迫感を再現。

---

## 4. ナビゲーション & 状態管理 (One Screen Policy)

Next.js (App Router) における画面遷移とState管理のルールです。

| 画面 / 機能 | 実装方針 | 備考 |
| :--- | :--- | :--- |
| **Profile画面** | `Page Push` | `/cast/[id]` へ遷移。 |
| **Chat画面** | `Page Push` | `/chat/[room_id]` へ遷移。 |
| **招待状作成 (Drawer)** | **State (Overlay)** | URL変更なし。`<AnimatePresence>` で制御。 |
| **招待状開封 (Modal)** | **State (Overlay)** | URL変更なし。背景スクロールロック。 |
| **No Show報告** | **State (Dialog)** | URL変更なし。 |

**実装イメージ:**
```tsx
// app/chat/[id]/page.tsx
export default function ChatPage() {
  // すべてのモーダル状態はこのページレベルで管理するか、Contextに切り出す
  const [mode, setMode] = useState<'chat' | 'builder' | 'invitation' | 'report'>('chat');

  return (
    <>
       <MessageList />
       <InputArea onOpenBuilder={() => setMode('builder')} />

       {/* 遷移させずにコンポーネントをマウント */}
       <AnimatePresence>
         {mode === 'builder' && <InvitationBuilderDrawer onClose={() => setMode('chat')} />}
         {mode === 'invitation' && <RitualOverlay onClose={() => setMode('chat')} />}
       </AnimatePresence>
    </>
  )
}
```

---

## 5. データベーススキーマ更新 (Supabase)

新機能に対応するため、以下のカラムを追加してください。

### `casts` table

* `current_status`: `text` (check: 'online', 'tonight', 'asking', 'busy') - デフォルト 'asking'
* `promise_rate`: `integer` - デフォルト 100 (計算ロジック実装までは固定値可)
* `radar_data`: `jsonb` - Default: `{"looks": 3, "promise": 5, "tech": 3, "talk": 3, "charm": 3}`

### `customers` table

* `no_show_count`: `integer` - デフォルト 0

### `reservations` table

* `status`: `text` に `'no_show'` を追加。
* Enum: `['offered', 'confirmed', 'visited', 'cancelled', 'no_show']`



---

## 6. 使用ライブラリ / 技術スタック

* **Framework:** Next.js (App Router)
* **Styling:** Tailwind CSS
* **Animation:** Framer Motion (必須: ドロワーの開閉、長押しリング、封蝋演出に使用)
* **Icons:** Lucide React
* **Backend:** Supabase (PostgreSQL)
