#!/bin/sh
set -e

# In Kubernetes, the database is created by the Postgres container (using POSTGRES_DB).
# We rely on DATABASE_URL for connection details.

echo "Running migrations..."
# Check if hanami exists before running
if [ -f "Gemfile" ]; then
  bundle exec hanami db create
  bundle exec hanami db migrate || echo "Migration failed (possibly no migrations), continuing..."
else
  echo "Gemfile not found, skipping migrations."
fi

echo "Starting gRPC server..."
exec ./bin/grpc
